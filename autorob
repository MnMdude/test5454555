-- Wait until the game is fully loaded
task.wait()

local TweenService = game:GetService("TweenService")
local HttpService = game:GetService("HttpService")
local TeleportService = game:GetService("TeleportService")
local RunService = game:GetService("RunService")
local PlayerService = game:GetService("Players")
local Player = PlayerService.LocalPlayer

local flyspeed = getgenv().FlySpeed or 50
local minPlayers = getgenv().ServerHop and getgenv().ServerHop.min or 5
local maxPlayers = getgenv().ServerHop and getgenv().ServerHop.max or 25
local teleportRetries = 3 -- Retry teleportation 3 times if it fails

-- Robbery items to look for
local MiniRobberies = {"Cash", "CashRegister", "DiamondBox", "Laptop", "Phone", "Luggage", "ATM", "TV", "Safe"}

-- Function to create ESP for a target
local function createESP(object, color)
    -- Create ESP UI objects
    local Billboard = Instance.new("BillboardGui")
    local Frame = Instance.new("Frame")

    -- BillboardGui settings
    Billboard.Name = "ESP"
    Billboard.Adornee = object
    Billboard.AlwaysOnTop = true
    Billboard.Size = UDim2.new(0, 200, 0, 50)
    Billboard.StudsOffset = Vector3.new(0, 2, 0)

    -- Frame settings
    Frame.Size = UDim2.new(1, 0, 1, 0)
    Frame.BackgroundTransparency = 0.5
    Frame.BackgroundColor3 = color
    Frame.BorderSizePixel = 0

    -- Parent UI elements
    Frame.Parent = Billboard
    Billboard.Parent = object
end

-- Function to add ESP to all players
local function addPlayerESP()
    for _, v in pairs(PlayerService:GetPlayers()) do
        if v ~= Player and v.Character and v.Character:FindFirstChild("HumanoidRootPart") then
            createESP(v.Character.HumanoidRootPart, Color3.fromRGB(255, 0, 0))  -- Red for players
        end
    end
end

-- Function to add ESP to robbery objects
local function addRobberyESP()
    for _, object in pairs(workspace.ObjectSelection:GetChildren()) do
        if table.find(MiniRobberies, object.Name) and object:IsDescendantOf(workspace) then
            createESP(object, Color3.fromRGB(0, 255, 0))  -- Green for robbery targets
        end
    end
end

-- Run ESP updates continuously
local function updateESP()
    -- Remove old ESPs
    for _, v in pairs(workspace:GetDescendants()) do
        if v:IsA("BillboardGui") and v.Name == "ESP" then
            v:Destroy()
        end
    end

    -- Add new ESPs
    addPlayerESP()
    addRobberyESP()
end

-- Connect the update function to every frame
RunService.RenderStepped:Connect(function()
    updateESP()
end)

-- Godmode function
local function enableGodmode()
    if Player.Character and Player.Character:FindFirstChild("Humanoid") then
        local humanoid = Player.Character.Humanoid

        -- Set health to a high value
        humanoid.MaxHealth = math.huge
        humanoid.Health = humanoid.MaxHealth

        -- Prevent damage by constantly setting health to max
        humanoid:GetPropertyChangedSignal("Health"):Connect(function()
            humanoid.Health = humanoid.MaxHealth
        end)

        -- Prevent fall damage by setting state to `PlatformStanding` (optional)
        humanoid.StateChanged:Connect(function(_, newState)
            if newState == Enum.HumanoidStateType.Freefall then
                humanoid:ChangeState(Enum.HumanoidStateType.PlatformStanding)
            end
        end)
    end
end

-- Enable godmode on character spawn
Player.CharacterAdded:Connect(function(character)
    task.wait(1)  -- Small wait to ensure character is fully loaded
    enableGodmode()
end)

-- Call godmode if character is already loaded
if Player.Character then
    enableGodmode()
end

-- Rest of your original code...
